---
layout: post
title: "Socket编程"
subtitle: "iOS Develop"
author": "Rex Ma"
date: 2015-12-22 15:30:35
header-img: "img/post-bg-12.jpg"
---

#Socket编程
前些日子，和几个好基友聊天，偶然间聊到计算机网络。再加上网络编程又是我们作为一个程序猿的必经之路，所以，决定把计算机网络中的一些重要知识点以及iOS中的Socket编程进行一个深入的学习，也给在路上的小伙伴们提供一些帮助。

##TCP和UDP

这俩货我相信如果你大学不是完全混过去的话~至少应该知道他们属于OSI模型中的**传输层**，至于这俩的区别，由于我上大学的时候计算机网络的老师极其地负责任，反复提醒TCP和UDP的区别是一个是可靠的连接，一个是不可靠的连接。但具体的区别如下：

**TCP:面向连接、传输可靠(保证数据正确性,保证数据顺序)、用于传输大量数据(流模式)、速度慢，建立连接需要开销较多(时间，系统资源)。**

**UDP:面向非连接、传输不可靠、用于传输少量数据(数据包模式)、速度快。**

关于TCP之所以比UDP可靠，是因为TCP在正式传输数据之前需要进行连接认证。如果失败，会进行重传。可靠带来的代价就是速度慢，但TCP依旧是主流。

##三次握手和四次挥手
关于三次握手这个概念，我相信大多数人如果学过计算机网络，在你们的试卷中，这是一道必考题。对于Socket变成而言，TCP连接的创建和拆除过程是由TCP/IP协议栈自动创建。但我认为了解这个过程也是十分必要的，所以我在Google上找了一个图片，来进行说明。

![TCP](http://machaotest.oss-cn-beijing.aliyuncs.com/picture%2FSocket%20TCP.png)

个人表示这张图还是挺直观地反映了三次握手和四次挥手。

为了方便说明，我先把图片上的标志说明一下，SYN（synchronous）同步标志，ACK(Acknowledgement)确认标志，以及图片中没有出现，但实际上是序列号的SEQ(Sequence Number)，FIN（final）则是结束标志。

###三次握手

第一次握手：客户端发起SYN报文，SYN的标志位为1，好吧虽然这张图没写出来，但是我要说清楚，**SYN标志位为1，SYN序列号SEQ为a。**

第二次握手：服务器发回SYN+ACK报文,**此时SYN与ACK的标志位均为1，ACK序列号为客户端SYN序列号加1，为a+1。并添加服务器的SYN序列号b**

第三次握手，客户端收到服务器的回答之后，**发送ACK报文,SYN标志位为0，ACK为1，并把ACK的序列号置为b+1。**

####写到这里可能有的人会比较迷糊，那我就说一下如何更加方便的记忆，首先，无论是客户端还是服务器，只要发出SYN包，那么SYN包的序列号肯定是独立的（就是各不相同的），之后，每一次发送的确认包（ACK）都是在之前一次握手的同步包（SYN）的序列号（SEQ）加1，还有就是只要是自己第一次发送的包，他的标志位就是1，但收回之后，SYN标志位置为0.

###四次挥手
